<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <title>Job SApply</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

<body>
    <nav class="navbar navbar-expand-lg">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">JobS-SApply</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link" aria-current="page" href="/">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/jobs">Jobs</a>
                    </li>
                </ul>
                <% if (locals.userEmail) { %>
                <ul class="navbar-nav me-1 mb-2 mb-lg-0 justify-content-center align-items-center" id="al">
                    Hello Recruiter
                    <li class="nav-item">
                        <a href="/logout" class="nav-link text-danger" id="logoutLink">Logout</a>
                    </li>
                </ul>
                <% } else { %>
                <ul class="navbar-nav me-1 mb-2 mb-lg-0" id="bl" style="display: block;">
                    <li class="nav-item">
                        <a href="#" class="nav-link effect-text" data-bs-toggle="modal"
                            data-bs-target="#applyModal">Recruiter SignIn/SignUp</a>
                    </li>
                </ul>
                <% } %>
            </div>
        </div>
    </nav>

    <div class="container-page">
        <%-body%>
    </div>
    <div class="container-fluid bg-dark ">
        <footer class="d-flex flex-wrap justify-content-between align-items-center p-3 mx-5">
            <div class="col-md-4 d-flex align-items-center text-light effect-text">
                Â© Vemuri Sai Srinivas, Inc
            </div>

            <ul class="nav col-md-4 col-12 justify-content-center justify-content-md-end list-unstyled d-flex mt-2">
                <li class=""><a class="text-light text-decoration-none px-3" href="https://www.instagram.com/_vemuri_/"
                        target="_blank"><i class="fa fa-instagram" aria-hidden="true"></i></a></li>
                <li class=""><a class="text-light text-decoration-none px-3"
                        href="https://www.linkedin.com/in/luckyandeee/" target="_blank"><i class="fa fa-linkedin"
                            aria-hidden="true"></i></a></li>
                <li class=""><a class="text-light text-decoration-none px-3" href="https://github.com/luckyandeee"
                        target="_blank"><i class="fa fa-github" aria-hidden="true"></i></a></li>
            </ul>
        </footer>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
        crossorigin="anonymous"></script>
</body>

</html>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

<script>
    // Show the name of the selected file in the custom file input label
    $(".custom-file-input").on("change", function () {
        var fileName = $(this).val().split("\\").pop();
        $(this).siblings(".custom-file-label").addClass("selected").html(fileName);
    });
</script>

<!-- Modal -->
<div class="modal fade" id="applyModal" tabindex="-1" aria-labelledby="applyModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title text-center w-100" id="applyModalLabel">SignIn/SignUp</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>

            </div>
            <!-- Pills navs -->
            <ul class="nav nav-pills justify-content-between mb-3 px-5 border-bottom" id="ex1" role="tablist">
                <li class="nav-item" role="presentation">
                    <a class="nav-link active text-center" id="tab-login" data-bs-toggle="pill" href="#pills-login"
                        role="tab" aria-controls="pills-login" aria-selected="true"
                        style="border:1px solid; border-radius:10%; width: 120px;">SignIn</a>
                </li>
                <li class="nav-item" role="presentation">
                    <a class="nav-link text-center" id="tab-register" data-bs-toggle="pill" href="#pills-register"
                        role="tab" aria-controls="pills-register" aria-selected="false"
                        style="border:1px solid; border-radius:10%; width: 120px;">SignUp</a>
                </li>
            </ul>
            <!-- Alert for validation errors -->
            <div id="registerAlert" class="alert alert-danger d-none" role="alert"></div>
            <div id="error-message" class="alert alert-danger px-5" role="alert" style="display: none;"></div>
            <!-- Alert for validation errors -->
            <div id="loginAlert" class="alert alert-danger d-none" role="alert"></div>
            <!-- Pills navs -->

            <!-- Pills content -->
            <div class="tab-content p-5 h-100">
                <div class="tab-pane fade show active" id="pills-login" role="tabpanel" aria-labelledby="tab-login">
                    <div id="success-message" class="alert alert-success px-5" role="alert" style="display: none;">Enter
                        proper details.!</div>
                    <form id="loginForm" action="/login" method="post">
                        <!-- Username input -->
                        <div class="form-outline mb-4">
                            <label class="form-label" for="loginName">Username</label>
                            <input type="text" id="loginName" class="form-control" name="username" />
                        </div>

                        <!-- Password input -->
                        <div class="form-outline mb-4">
                            <label class="form-label" for="loginPassword">Password</label>
                            <input type="password" id="loginPassword" class="form-control" name="password" />
                        </div>

                        <!-- Submit button -->
                        <button type="submit" class="btn btn-primary btn-block mb-4">Sign In</button>

                        <!-- Success and Error Messages -->
                        <div id="success-message" style="display:none;color:green;"></div>
                        <div id="error-message" style="display:none;color:red;"></div>
                    </form>
                </div>
                <div class="tab-pane fade" id="pills-register" role="tabpanel" aria-labelledby="tab-register">
                    <div id="error-message" class="alert alert-danger px-5" role="alert" style="display: none;"></div>
                    <form id="registerForm" action="/register" method="post">
                        <!-- Name input -->
                        <div class="form-outline mb-4">
                            <label class="form-label" for="registerName">User Name</label>
                            <input type="text" id="registerName" class="form-control" name="username" />
                        </div>

                        <!-- Email input -->
                        <div class="form-outline mb-4">
                            <label class="form-label" for="registerEmail">Email</label>
                            <input type="text" id="registerEmail" class="form-control" name="email" />
                        </div>

                        <!-- Password input -->
                        <div class="form-outline mb-4">
                            <label class="form-label" for="registerPassword">Password</label>
                            <input type="password" id="registerPassword" class="form-control" name="password" />
                        </div>

                        <!-- Submit button -->
                        <button type="submit" class="btn btn-primary btn-block mb-3">Register</button>
                    </form>
                </div>
            </div>
            <!-- Pills content -->
        </div>
    </div>
</div>
<script>
    document.getElementById('registerForm').addEventListener('submit', function (event) {
        event.preventDefault();
        const form = event.target;

        fetch(form.action, {
            method: form.method,
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                username: form.username.value || true,
                email: form.email.value || true,
                password: form.password.value || true,
            })
        }).then(response => response.json()).then(data => {
            if (data.success) {

                // Switch to the login tab
                document.getElementById('success-message').textContent = data.Message;
                document.getElementById('success-message').style.display = "block";
                document.getElementById('error-message').style.display = "none";
                document.querySelector('a[href="#pills-login"]').click();

            } else {
                document.getElementById('error-message').textContent = data.errorMessage;
                document.getElementById('error-message').style.display = "block";
            }
        }).catch(error => {
            console.error('Error:', error);
        });
    });

    // login script
    document.getElementById('loginForm').addEventListener('submit', function (event) {
        event.preventDefault();
        const form = event.target;

        fetch(form.action, {
            method: form.method,
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                username: form.username.value,
                password: form.password.value,
            })
        }).then(response => response.json()).then(data => {
            if (data.success) {
                document.getElementById('success-message').textContent = data.Message;
                document.getElementById('success-message').style.display = "block";
                document.getElementById('error-message').style.display = "none";
                document.getElementById('bl').style.display = "none";

                // Close the modal after a slight delay to allow the success message to be seen
                setTimeout(() => {
                    window.location.href = '/';
                }, 1000); // 1 second delay

            } else {
                // Show error message
                document.getElementById('error-message').textContent = data.errorMessage;
                document.getElementById('error-message').style.display = "block";
            }
        }).catch(error => {
            console.error('Error:', error);
            document.getElementById('error-message').textContent = "An error occurred during login.";
            document.getElementById('error-message').style.display = "block";
        });
    });


</script>